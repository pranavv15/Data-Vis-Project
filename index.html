<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Vis Project</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        svg {
            width: 100%;
            height: 100%;
        }
        #container {
            width: 80%;
            margin: auto;
            padding-top: 3%;
        }
        .yAxis {
            font-size: x-small;
        }
    </style>

</head>
<body>
    <h1>The count of cancer patients in the country</h1>
    <h3>Visualized by sex</h3>
    <div id="container">
        <svg viewBox = "0 0 1200 600">

        </svg>
    </div>
    <script>

    const svg = d3.select("svg")
    let margins = {top: 20, bottom:50, left:50, right:20}

    data = "Cancer-Data.csv"
    d3.csv(data, function(d){
        return {
            State: String(d.States),
            Male:   Number(d["Male"]),
            Female: Number(d["Female"])
        }
    }).then(d => {
       
        k = d3.map(d, function(d) {return d["State"]})
        console.log(k[8])
        let stack = d3.stack().keys(["Male","Female"])
        stackedseries = stack(d)

        

        let xmin_max = {min:0,max: d3.max(stackedseries, function(d){
            return d3.max(d, function(d){
                return d[1];
            })
        })}
       
        const width = svg.attr('width')
        const height = svg.attr('height')
        
        xScale = d3.scaleLinear()
                    .domain([xmin_max.min, xmin_max.max])
                    .range([0+margins.left,1200-margins.right])
        yScale = d3.scaleBand()
                    .domain(d3.map(d, function(d) {return d["State"]}))
                    .range([(600-margins.bottom), (0+margins.top)])

       
        color = ['#E9A6A6','#1F1D36']
        let groups = svg.selectAll('g').data(stackedseries).enter().append('g')
                        .style('fill', function(d,i) {
                                return color[i]
                        })
        console.log(groups);

        // let rects = groups.selectAll("rect").data(function(d) {return d}).enter().append("rect")
        //                     .attr("x", function(d){return xScale(d[0])})
        //                     .attr("y", function(d,i) {return yScale(k[i])}) 
        //                     .attr("width", function(d) {return xScale(d[1])-xScale(d[0])})
        //                     .transition()
        //                     .delay(function(d,i){return i*100})
        //                     .duration(1000)
        //                     .attr("height", d=> 10)


        let rects = groups.selectAll("rect").data(function(d) {return d}).enter().append("rect")
                            .attr("x", function(d){return 0+margins.left})
                            .attr("y", function(d,i) {return yScale(k[i])}) 
                            .attr("height", d=> 10)
                            .attr("width", function(d) {return 0})
                            .transition()
                            .delay(function(d,i){return i*100})
                            .duration(100)
                            .attr("x", function(d){return xScale(d[0])})
                            .attr("width", function(d) {return xScale(d[1])-xScale(d[0])})
                            .attr("height", d=> 10)
                            .on("mouseover", function(d){
                                
                            })
        
        let y_axis = svg.append('g')
                        .attr("transform", "translate("+margins.left+", "+0+")")
                        .attr("class","yAxis")
                        .call(d3.axisLeft(yScale))
        let x_axis = svg.append('g')
                        .attr("transform", "translate(0, "+(600-margins.bottom)+")")
                        .attr("class","yAxis")
                        .call(d3.axisBottom(xScale))

        svg.append("circle").attr("cx",1080).attr("cy",20).attr("r", 6).style("fill",'#E9A6A6' )
        svg.append("circle").attr("cx",1080).attr("cy",40).attr("r", 6).style("fill", '#1F1D36')
        svg.append("text").attr("x", 1100).attr("y", 25).text("Male").style("font-size", "15px").attr("alignment-baseline","top-right")
        svg.append("text").attr("x", 1100).attr("y", 45).text("Female").style("font-size", "15px").attr("alignment-baseline","top-right")
        
    })
    </script>
    
</body>
</html>